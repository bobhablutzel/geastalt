# Copyright (c) 2026 Bob Hablutzel. All rights reserved.
#
# Licensed under a dual-license model: freely available for non-commercial use;
# commercial use requires a separate license. See LICENSE file for details.
# Contact license@geastalt.com for commercial licensing.

# Default values for address-istio
# This is a YAML-formatted file.

# Gateway configuration
# Disabled by default â€” address is a Kafka consumer and does not serve external traffic.
# Enable only if this service needs to be exposed via the Istio ingress gateway.
gateway:
  enabled: false
  name: address-gateway
  host: "*"
  selector:
    istio: ingressgateway

# Service configuration
service:
  name: address
  namespace: geastalt
  grpcPort: 9010
  httpPort: 9011

# Virtual service configuration
virtualService:
  retries:
    attempts: 3
    perTryTimeout: 10s
    retryOn: connect-failure,refused-stream,unavailable,cancelled,retriable-status-codes
  timeout: 30s

# Destination rule configuration
destinationRule:
  loadBalancer:
    simple: ROUND_ROBIN
  connectionPool:
    http:
      h2UpgradePolicy: UPGRADE
      http2MaxRequests: 100
      maxRequestsPerConnection: 10
  outlierDetection:
    consecutive5xxErrors: 3
    interval: 30s
    baseEjectionTime: 30s
    maxEjectionPercent: 50
  tls:
    mode: ISTIO_MUTUAL

# Peer authentication (mTLS)
peerAuthentication:
  mtls:
    mode: PERMISSIVE
