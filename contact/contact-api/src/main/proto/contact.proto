/*
 * Copyright (c) 2026 Bob Hablutzel. All rights reserved.
 *
 * Licensed under a dual-license model: freely available for non-commercial use;
 * commercial use requires a separate license. See LICENSE file for details.
 * Contact license@geastalt.com for commercial licensing.
 */

syntax = "proto3";

package com.geastalt.contact.grpc;

option java_multiple_files = true;
option java_package = "com.geastalt.contact.grpc";
option java_outer_classname = "ContactProto";

service ContactService {
  // Address operations
  rpc AddAddress (AddAddressRequest) returns (AddAddressResponse);
  rpc UpdateAddress (UpdateAddressRequest) returns (UpdateAddressResponse);
  rpc GetAddresses (GetAddressesRequest) returns (GetAddressesResponse);
  rpc RemoveAddress (RemoveAddressRequest) returns (RemoveAddressResponse);

  // Email operations
  rpc AddEmail (AddEmailRequest) returns (AddEmailResponse);
  rpc UpdateEmail (UpdateEmailRequest) returns (UpdateEmailResponse);
  rpc GetEmails (GetEmailsRequest) returns (GetEmailsResponse);
  rpc RemoveEmail (RemoveEmailRequest) returns (RemoveEmailResponse);

  // Phone operations
  rpc AddPhone (AddPhoneRequest) returns (AddPhoneResponse);
  rpc UpdatePhone (UpdatePhoneRequest) returns (UpdatePhoneResponse);
  rpc GetPhones (GetPhonesRequest) returns (GetPhonesResponse);
  rpc RemovePhone (RemovePhoneRequest) returns (RemovePhoneResponse);

  // Search operations
  rpc SearchContacts (SearchContactsRequest) returns (SearchContactsResponse);
  rpc GetContactById (GetContactByIdRequest) returns (GetContactByIdResponse);
  rpc GetContactByAlternateId (GetContactByAlternateIdRequest) returns (GetContactByAlternateIdResponse);
  rpc SearchContactsByPhone (SearchContactsByPhoneRequest) returns (SearchContactsByPhoneResponse);

  // Contact operations
  rpc CreateContact (CreateContactRequest) returns (CreateContactResponse);
  rpc BulkCreateContacts (BulkCreateContactsRequest) returns (BulkCreateContactsResponse);

  // Pending action operations
  rpc HasPendingAction (HasPendingActionRequest) returns (HasPendingActionResponse);

  // Contract operations
  rpc CreateContract (CreateContractRequest) returns (CreateContractResponse);
  rpc UpdateContract (UpdateContractRequest) returns (UpdateContractResponse);
  rpc GetContract (GetContractRequest) returns (GetContractResponse);
  rpc GetContracts (GetContractsRequest) returns (GetContractsResponse);
  rpc DeleteContract (DeleteContractRequest) returns (DeleteContractResponse);

  // Partition operations
  rpc GetContactPartition (GetContactPartitionRequest) returns (GetContactPartitionResponse);

  // Contact contract operations
  rpc AddContactContract (AddContactContractRequest) returns (AddContactContractResponse);
  rpc UpdateContactContract (UpdateContactContractRequest) returns (UpdateContactContractResponse);
  rpc GetContactContracts (GetContactContractsRequest) returns (GetContactContractsResponse);
  rpc GetCurrentContactContract (GetCurrentContactContractRequest) returns (GetCurrentContactContractResponse);
  rpc RemoveContactContract (RemoveContactContractRequest) returns (RemoveContactContractResponse);
}

enum AddressType {
  ADDRESS_TYPE_UNSPECIFIED = 0;
  HOME = 1;
  BUSINESS = 2;
  MAILING = 3;
}

// Pending action types
enum PendingActionType {
  PENDING_ACTION_TYPE_UNSPECIFIED = 0;
  GENERATE_EXTERNAL_IDENTIFIERS = 1;
}

message AlternateIdEntry {
  string type = 1;
  string alternate_id = 2;
}

message AddAddressRequest {
  int64 contact_id = 1;
  int64 address_id = 2;
  AddressType address_type = 3;
}

message AddAddressResponse {
  int64 id = 1;
  int64 contact_id = 2;
  int64 address_id = 3;
  AddressType address_type = 4;
  ContactAddressDetails address_details = 5;
}

message UpdateAddressRequest {
  int64 contact_id = 1;
  int64 address_id = 2;
  AddressType address_type = 3;
}

message UpdateAddressResponse {
  int64 id = 1;
  int64 contact_id = 2;
  int64 address_id = 3;
  AddressType address_type = 4;
  ContactAddressDetails address_details = 5;
}

message GetAddressesRequest {
  int64 contact_id = 1;
}

message GetAddressesResponse {
  repeated ContactAddressEntry addresses = 1;
}

message ContactAddressEntry {
  int64 id = 1;
  AddressType address_type = 2;
  int64 address_id = 3;
  ContactAddressDetails address_details = 4;
}

message ContactAddressDetails {
  repeated string address_lines = 1;
  string locality = 2;
  string administrative_area = 3;
  string postal_code = 4;
  string country_code = 5;
  string sub_locality = 6;
  string sorting_code = 7;
  bool validated = 8;
}

message RemoveAddressRequest {
  int64 contact_id = 1;
  AddressType address_type = 2;
}

message RemoveAddressResponse {
  bool success = 1;
}

// Email types and messages
enum EmailType {
  EMAIL_TYPE_UNSPECIFIED = 0;
  EMAIL_HOME = 1;
  EMAIL_BUSINESS = 2;
  EMAIL_MAILING = 3;
}

message AddEmailRequest {
  int64 contact_id = 1;
  string email = 2;
  EmailType email_type = 3;
}

message AddEmailResponse {
  int64 id = 1;
  int64 contact_id = 2;
  string email = 3;
  EmailType email_type = 4;
}

message UpdateEmailRequest {
  int64 contact_id = 1;
  string email = 2;
  EmailType email_type = 3;
}

message UpdateEmailResponse {
  int64 id = 1;
  int64 contact_id = 2;
  string email = 3;
  EmailType email_type = 4;
}

message GetEmailsRequest {
  int64 contact_id = 1;
}

message GetEmailsResponse {
  repeated ContactEmailEntry emails = 1;
}

message ContactEmailEntry {
  int64 id = 1;
  EmailType email_type = 2;
  string email = 3;
}

message RemoveEmailRequest {
  int64 contact_id = 1;
  EmailType email_type = 2;
}

message RemoveEmailResponse {
  bool success = 1;
}

// Phone types and messages
enum PhoneType {
  PHONE_TYPE_UNSPECIFIED = 0;
  PHONE_HOME = 1;
  PHONE_BUSINESS = 2;
  PHONE_MAILING = 3;
}

message AddPhoneRequest {
  int64 contact_id = 1;
  string phone_number = 2;
  PhoneType phone_type = 3;
}

message AddPhoneResponse {
  int64 id = 1;
  int64 contact_id = 2;
  string phone_number = 3;
  PhoneType phone_type = 4;
}

message UpdatePhoneRequest {
  int64 contact_id = 1;
  string phone_number = 2;
  PhoneType phone_type = 3;
}

message UpdatePhoneResponse {
  int64 id = 1;
  int64 contact_id = 2;
  string phone_number = 3;
  PhoneType phone_type = 4;
}

message GetPhonesRequest {
  int64 contact_id = 1;
}

message GetPhonesResponse {
  repeated ContactPhoneEntry phones = 1;
}

message ContactPhoneEntry {
  int64 id = 1;
  PhoneType phone_type = 2;
  string phone_number = 3;
}

message RemovePhoneRequest {
  int64 contact_id = 1;
  PhoneType phone_type = 2;
}

message RemovePhoneResponse {
  bool success = 1;
}

// Search messages
message SearchContactsRequest {
  string last_name = 1;           // Required, supports "Smith*" wildcard
  string first_name = 2;          // Optional, supports "Jo*" wildcard
  int32 max_results = 3;          // Optional, default 25, max 1000
  bool include_total_count = 4;   // Optional, default false (skips expensive count query)
}

message SearchContactsResponse {
  repeated ContactEntry contacts = 1;
  int32 total_count = 2;          // Only populated if include_total_count=true
}

message ContactEntry {
  int64 id = 1;
  repeated AlternateIdEntry alternate_ids = 6;
  string first_name = 2;
  string last_name = 3;
  optional string preferred_email = 4;
  optional ContactAddressDetails preferred_address = 5;
}

// Contact ID lookup
message GetContactByIdRequest {
  int64 contact_id = 1;
}

message GetContactByIdResponse {
  ContactEntry contact = 1;
}

// Alternate ID lookup
message GetContactByAlternateIdRequest {
  string alternate_id = 1;
  string type = 2;  // Defaults to NEW_NATIONS if not specified
}

message GetContactByAlternateIdResponse {
  ContactEntry contact = 1;
}

// Phone search
message SearchContactsByPhoneRequest {
  string phone_number = 1;
  int32 max_results = 2;  // Optional, default 25
}

message SearchContactsByPhoneResponse {
  repeated ContactEntry contacts = 1;
}

// Pending action check
message HasPendingActionRequest {
  int64 contact_id = 1;
  PendingActionType action_type = 2;
}

message HasPendingActionResponse {
  bool has_pending_action = 1;
}

// Create contact
message CreateContactRequest {
  string first_name = 1;
  string last_name = 2;
  bool skip_generate_external_identifiers = 3;  // If true, don't add GENERATE_EXTERNAL_IDENTIFIERS pending action
  string company_name = 5;                      // Used for partition assignment (e.g., "Humana")
}

message CreateContactResponse {
  ContactEntry contact = 1;
  int32 partition_number = 2;
}

// Bulk create contacts
message BulkCreateContactsRequest {
  repeated ContactInput contacts = 1;
  bool skip_generate_external_identifiers = 2;  // Applies to all contacts
}

message ContactInput {
  string first_name = 1;
  string last_name = 2;
  repeated PhoneInput phones = 3;
  repeated EmailInput emails = 4;
  repeated AddressInput addresses = 5;
  string company_name = 6;                      // Used for partition assignment (e.g., "Humana")
}

message PhoneInput {
  string phone_number = 1;
  PhoneType phone_type = 2;
}

message EmailInput {
  string email = 1;
  EmailType email_type = 2;
}

message AddressInput {
  AddressType address_type = 1;
  repeated string address_lines = 2;
  string locality = 3;
  string administrative_area = 4;
  string postal_code = 5;
  string country_code = 6;
}

message BulkCreateContactsResponse {
  repeated BulkCreateResult results = 1;
  int32 total_count = 2;
  int32 success_count = 3;
  int32 failure_count = 4;
}

message BulkCreateResult {
  int32 index = 1;              // Index in the input array
  bool success = 2;
  int64 contact_id = 3;          // Populated if success=true
  string error_message = 4;     // Populated if success=false
  int32 partition_number = 5;   // Populated if success=true
}

// Contract messages
message ContractEntry {
  string contract_id = 1;
  string contract_name = 2;
  string company_id = 3;
  string company_name = 4;
}

message CreateContractRequest {
  string contract_name = 1;
  string company_id = 2;
  string company_name = 3;
}

message CreateContractResponse {
  ContractEntry contract = 1;
}

message UpdateContractRequest {
  string contract_id = 1;
  string contract_name = 2;
  string company_id = 3;
  string company_name = 4;
}

message UpdateContractResponse {
  ContractEntry contract = 1;
}

message GetContractRequest {
  string contract_id = 1;
}

message GetContractResponse {
  ContractEntry contract = 1;
}

message GetContractsRequest {
}

message GetContractsResponse {
  repeated ContractEntry contracts = 1;
}

message DeleteContractRequest {
  string contract_id = 1;
}

message DeleteContractResponse {
  bool success = 1;
}

// Contact contract messages
message ContactContractEntry {
  int64 id = 1;
  int64 contact_id = 2;
  ContractEntry contract = 3;
  string effective_date = 4;    // ISO 8601 UTC datetime: YYYY-MM-DDTHH:MM:SSZ
  string expiration_date = 5;   // ISO 8601 UTC datetime: YYYY-MM-DDTHH:MM:SSZ
  bool is_current = 6;
}

message AddContactContractRequest {
  int64 contact_id = 1;
  string contract_id = 2;
  string effective_date = 3;    // ISO 8601 UTC datetime: YYYY-MM-DDTHH:MM:SSZ
  string expiration_date = 4;   // ISO 8601 UTC datetime: YYYY-MM-DDTHH:MM:SSZ
}

message AddContactContractResponse {
  ContactContractEntry contact_contract = 1;
}

message UpdateContactContractRequest {
  int64 id = 1;                 // Contact contract ID
  string contract_id = 2;
  string effective_date = 3;    // ISO 8601 UTC datetime: YYYY-MM-DDTHH:MM:SSZ
  string expiration_date = 4;   // ISO 8601 UTC datetime: YYYY-MM-DDTHH:MM:SSZ
}

message UpdateContactContractResponse {
  ContactContractEntry contact_contract = 1;
}

message GetContactContractsRequest {
  int64 contact_id = 1;
}

message GetContactContractsResponse {
  repeated ContactContractEntry contact_contracts = 1;
}

message GetCurrentContactContractRequest {
  int64 contact_id = 1;
}

message GetCurrentContactContractResponse {
  ContactContractEntry contact_contract = 1;  // Will be empty if no current contract
}

message RemoveContactContractRequest {
  int64 contact_id = 1;
  int64 id = 2;                 // Contact contract ID
}

message RemoveContactContractResponse {
  bool success = 1;
}

// Partition lookup
message GetContactPartitionRequest {
  int64 contact_id = 1;
}

message GetContactPartitionResponse {
  int64 contact_id = 1;
  int32 partition_number = 2;
}
